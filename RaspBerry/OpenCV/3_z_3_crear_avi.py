#!/usr/bin/python
# -*- coding: utf-8 -*-
"""
////////////////////////////////////////////////////////////////////////////////////
//   AUTOR:CIFPN1                                              Octubre/2018
////////////////////////////////////////////////////////////////////////////////////
//   PROGRAMA: GUARDAR VIDEO                         VERSIÓN: 1.0      
//   DISPOSITIVO: Broadcom BCM2837B0, Cortex-A53 (ARMv8) 64-bit SoC                              
//   Versión Python:   3.5.3                             
//   TARJETA DE APLICACIÓN: Raspberry Pi 3 B+                   
////////////////////////////////////////////////////////////////////////////////////
Guarda un video DIVX, grabado desde la cam
////////////////////////////////////////////////////////////////////////////////////
"""

#////////////////////////////////////////////////////////////////////////////////////
# IMPORTAR LIBRERÍAS E INSTANCIAR CLASES
#////////////////////////////////////////////////////////////////////////////////////
import numpy as np
import cv2

cap = cv2.VideoCapture(0) #Creamos el objeto 'cap'

# Define el codec y crea el objeto VideoWriter
fourcc = cv2.VideoWriter_fourcc(*'DIVX')
out = cv2.VideoWriter('output.avi',fourcc, 20.0, (640,480))
#////////////////////////////////////////////////////////////////////////////////////
# VARIABLES GLOBALES
#////////////////////////////////////////////////////////////////////////////////////


#////////////////////////////////////////////////////////////////////////////////////
# FUNCIONES
#////////////////////////////////////////////////////////////////////////////////////


#////////////////////////////////////////////////////////////////////////////////////
# CONFIGURACIÓN PUERTOS GPIO Y RECURSOS A UTILIZAR
#////////////////////////////////////////////////////////////////////////////////////


#////////////////////////////////////////////////////////////////////////////////////
# PROGRAMA PRINCIPAL
#////////////////////////////////////////////////////////////////////////////////////
try:                 
    while(cap.isOpened()):
        ret, frame = cap.read()
        if ret==True:
           frame = cv2.flip(frame,0) #invierte el cuadro
            
           # escribe el cuadro invertido 
           out.write(frame)
           cv2.imshow('frame',frame)
           if cv2.waitKey(1) & 0xFF == ord('q'):
               break
        else:
            break

except KeyboardInterrupt:         #Si el usuario pulsa CONTROL+C entonces...
    print("El usuario ha pulsado Ctrl+C...")

except:
    print("error inesperado")

finally:
#Libera todo si la tarea ha terminado
    cap.release()
    out.release()
    cv2.destroyAllWindows()
